---
title: "miRNA and siRNA modelling"
output: html_notebook
---


```{r setup}
library(deSolve)
library(tidyverse)
library(cowplot)
```

Using nM as unit, K_m and k_cat from Zamore 2015.
AGO abundance (E_0) from Wang et al. 2012 Quantitative functions of Argonaute
proteins in mammalian development

cell radius / volume guessed

Notes 2018-09-05:
miRNA does not deplete in ooczt ine  20h
miRNA silencing hapens on the order of hours
Need to consider competition with siRNAs and loading unloading
AGO + siRNA will stay loaded, AGO + miRNA might not
AGO + miRNA has intermediate stages

Denzler has total miRNA to siRNA counts (hopefully). 
Somatic cell has only miRNA (but siRNA can be induced)

miRNA seed vs. seed and something


Further notes:
In Zamore 2012 Fig. 7 the $K_M$ values are about a factor of 2.5 off from what would be calculated from $k_{on}$, $k_{off}$ and $k_cat$ - those are different experiments.

Bosson 2014:
Absolute levels of miRNAs for various cell types are estimated in the range of tens to 
120,000 copies per cell

This method provided target cpc estimates of 1,200 8-mers, 5,000 7-mers, and 22,000 6-
mers on average for 3â€² UTR sites of each active miRNA ESC family (Figure 3D, lines). For 
reference to other cell types, these values correspond to 0.8%, 3.2%, and 14.1% of the total 
mRNA concentration in the cell. 

```{r}
#mole_unit <- 6.022e20 #Mili mole
# mole_unit_from_nano_mole <- 1e-6
# mole_unit_from_mole <- 1e3

mole_unit <- 6.022e14 #nano mole
mole_unit_from_nano_mole <- 1
mole_unit_from_mole <- 1e9
time_unit_from_sec <- 1/3600 #Use hour instead of seconds

K_M_siRNA <- 0.1 * mole_unit_from_nano_mole
k_on_siRNA <- 3.6e7 / (mole_unit_from_mole * time_unit_from_sec)
k_off_siRNA <- 7.7e-4 / time_unit_from_sec
k_cat_siRNA <- 8.1e-4 / time_unit_from_sec

k_on_miRNA <- 0.2e8 / (mole_unit_from_mole * time_unit_from_sec)
k_off_miRNA <- 0.051e-2 / time_unit_from_sec


AGO_somatic <- 1.7e5 / mole_unit
AGO_oocyte <- AGO_somatic

miRNA_target_proportion <- 0.2
siRNA_target_proportion <- miRNA_target_proportion

total_RNA_somatic <- 1e6 #5e5 - 1e6
total_RNA_oocyte <- 25e6

miRNA_target_somatic <- total_RNA_somatic * miRNA_target_proportion / mole_unit
siRNA_target_somatic <- total_RNA_somatic * siRNA_target_proportion / mole_unit
#somatic_radius <- 10e-6 
#somatic_volume <- (4/3)*pi* somatic_radius^3 * 1e3 #transforming from m^3 to litres
somatic_volume <- 4.4e-12

miRNA_target_oocyte <- total_RNA_oocyte * miRNA_target_proportion / mole_unit
siRNA_target_oocyte <- total_RNA_somatic * siRNA_target_proportion / mole_unit

#oocyte_radius <- 80e-6 
#oocyte_volume <- (4/3)*pi* oocyte_radius^3 * 1e3 #transforming from m^3 to litres
oocyte_volume <- 260e-12

times <- seq(0,24*60*60 * time_unit_from_sec, length.out = 100)



```


## Simulating MM kinetics for siRNA yields very fast degradation

Hence the loading step is likely limiting. Setting lower prop_AGO_available yields more reasonable results.


```{r}
one_step_degradation <- function(t, state, parameters) {
  with(as.list(c(state, parameters)), {
    d_target <- -k_on * enzyme * target + k_off * complex 
    d_enzyme <- -k_on * enzyme * target + k_off * complex + k_cat * complex
    d_complex <- k_on * enzyme * target - k_off * complex - k_cat * complex
    list(c(d_target, d_enzyme, d_complex))
  })
}

plot_ode_result <- function(out, title) {
  out_tidy <- out %>% as.data.frame() %>% 
    gather(type, concentration, -time) %>%
    mutate(time_h = time / (3600 * time_unit_from_sec)) 
    
  
  uncleaved_plot <- out_tidy %>% 
    filter(type != "enzyme") %>%
    group_by(time_h) %>%
    summarise(all_uncleaved = sum(concentration)) %>%
    (function(data) { 
      ggplot(data,aes(x = time_h, y = all_uncleaved)) + geom_line() +
        ggtitle(paste0(title," uncleaved RNAs"))  +
        ylim(-1e-5, max(data$all_uncleaved)) 
    })

  print(uncleaved_plot)
  
  auxiliary_plot <- 
    ggplot(out_tidy, aes(x = time_h, y = concentration, color = type, linetype = type)) + geom_line() +
    ggtitle(paste0(title," all reactants") ) + 
    ylim(-1e-5, max(out_tidy$concentration))


  print(auxiliary_plot)
}

for(prop_AGO_available_siRNA in c(1,0.5,0.1)) {



  params_siRNA <- c(k_cat = k_cat_siRNA, k_on = k_on_siRNA, k_off = k_off_siRNA)
  
  state <- c(target = siRNA_target_somatic / somatic_volume, enzyme = prop_AGO_available_siRNA * AGO_somatic / somatic_volume, complex = 0)
  
  out_siRNA <- ode(y = state, times = times, func = one_step_degradation, parms = params_siRNA)
  
  
  
  plot_ode_result(out_siRNA,paste0("Somatic, prop AGO = ", prop_AGO_available_siRNA))
  
  
  
  state <- c(target = siRNA_target_oocyte / oocyte_volume, enzyme = prop_AGO_available_siRNA * AGO_oocyte / oocyte_volume, complex = 0)
  
  out_siRNA_oo <- ode(y = state, times = times, func = one_step_degradation, parms = params_siRNA)
  
  plot_ode_result(out_siRNA_oo,paste0("Oocyte, prop AGO = ", prop_AGO_available_siRNA))
}
```

Modulating just k_cat for miRNA is enough - to get full miRNA efficiency at somatic cells but have negligible degradation in oocyte.

```{r}

prop_AGO_available_miRNA = 0.1


k_cat_miRNA_one_step <- 0.2 * k_cat_siRNA
params_miRNA_one_step <- c(k_cat = k_cat_miRNA_one_step, k_on = k_on_miRNA, k_off = k_off_miRNA)

state <- c(target = miRNA_target_somatic / somatic_volume, enzyme = prop_AGO_available_miRNA * AGO_somatic / somatic_volume, complex = 0)

out_miRNA_one_step_somatic <- ode(y = state, times = times, func = one_step_degradation, parms = params_miRNA_one_step)

plot_ode_result(out_miRNA_one_step_somatic, "miRNA - somatic - one step deg.")


state <- c(target = miRNA_target_oocyte / oocyte_volume, enzyme = prop_AGO_available_miRNA * AGO_oocyte / oocyte_volume, complex = 0)

out_miRNA_one_step_oo <- ode(y = state, times = times, func = one_step_degradation, parms = params_miRNA_one_step)

plot_ode_result(out_miRNA_one_step_oo, "miRNA - Oocyte - one step deg.")

```

Experimenting with two step reactions

```{r}
k_cat_miRNA <- 0.2 * k_cat_siRNA
k_intermediate_miRNA <- 1 * k_cat_siRNA


two_step_degradation <- function(t, state, parameters) {
  with(as.list(c(state, parameters)), {
    d_target <- -k_on * enzyme * target + k_off * complex 
    d_enzyme <- -k_on * enzyme * target + k_off * complex + k_cat * intermediate
    d_complex <- k_on * enzyme * target - k_off * complex - k_intermediate * complex
    d_intermediate <- k_intermediate * complex - k_cat * intermediate
    list(c(d_target, d_enzyme, d_complex, d_intermediate))
  })
}

params_miRNA <- c(k_on = k_on_miRNA, k_off = k_off_miRNA, k_cat = k_cat_miRNA, k_intermediate = k_intermediate_miRNA)

state_somatic <- c(target = miRNA_target_somatic / somatic_volume, enzyme = (prop_AGO_available_miRNA * AGO_somatic) / somatic_volume, complex = 0, intermediate = 0)

out_miRNA <- ode(y = state_somatic, times = times, func = two_step_degradation, parms = params_miRNA)



plot_ode_result(out_miRNA, "Somatic")

state_oo <- c(target = miRNA_target_oocyte / oocyte_volume, enzyme = (prop_AGO_available_miRNA * AGO_oocyte) / oocyte_volume, complex = 0, intermediate = 0)

out_miRNA_oo <- ode(y = state_oo, times = times, func = two_step_degradation, parms = params_miRNA)

plot_ode_result(out_miRNA_oo, "Oocyte")


```

