---
title: "miRNA and siRNA modelling"
output: html_notebook
---


```{r setup}
library(deSolve)
library(tidyverse)
library(cowplot)
```

Using nM as unit, K_m and k_cat from Zamore 2015.
AGO abundance (E_0) from Wang et al. 2012 Quantitative functions of Argonaute
proteins in mammalian development

cell radius / volume guessed

Notes 2018-09-05:
miRNA does not deplete in ooczt ine  20h
miRNA silencing hapens on the order of hours
Need to consider competition with siRNAs and loading unloading
AGO + siRNA will stay loaded, AGO + miRNA might not
AGO + miRNA has intermediate stages

Denzler has total miRNA to siRNA counts (hopefully). 
Somatic cell has only miRNA (but siRNA can be induced)

miRNA seed vs. seed and something


Further notes:
In Zamore 2012 Fig. 7 the $K_M$ values are about a factor of 2.5 off from what would be calculated from $k_{on}$, $k_{off}$ and $k_cat$ - those are different experiments.


```{r}
#mole_unit <- 6.022e20 #Mili mole
# mole_unit_from_nano_mole <- 1e-6
# mole_unit_from_mole <- 1e3

mole_unit <- 6.022e14 #nano mole
mole_unit_from_nano_mole <- 1
mole_unit_from_mole <- 1e9

K_M_siRNA <- 0.1 * mole_unit_from_nano_mole
k_on_siRNA <- 3.6e7 / mole_unit_from_mole
k_off_siRNA <- 7.7e-4
k_cat_siRNA <- 8.1e-4

k_on_miRNA <- 0.2e8 / mole_unit_from_mole
k_off_miRNA <- 0.051e-2


AGO_somatic <- 1.7e5 / mole_unit
AGO_oocyte <- AGO_somatic

siRNA_target_somatic <- 5000 / mole_unit
miRNA_target_somatic <- siRNA_target_somatic
somatic_radius <- 10e-6 
somatic_volume <- (4/3)*pi* somatic_radius^3

siRNA_target_oocyte <- 5e5 / mole_unit
miRNA_target_oocyte <- siRNA_target_oocyte
oocyte_radius <- 80e-6 
oocyte_volume <- (4/3)*pi* oocyte_radius^3

times <- seq(0,6*60*60, length.out = 100)



```


## Simulating MM kinetics for siRNA yields very fast degradation

Hence the loading step is likely limiting. Setting lower prop_AGO_available yields more reasonable results.


```{r}
one_step_degradation <- function(t, state, parameters) {
  with(as.list(c(state, parameters)), {
    d_target <- -k_on * enzyme * target + k_off * complex 
    d_enzyme <- -k_on * enzyme * target + k_off * complex + k_cat * complex
    d_complex <- k_on * enzyme * target - k_off * complex - k_cat * complex
    list(c(d_target, d_enzyme, d_complex))
  })
}

plot_ode_result <- function(out, title) {
  out_tidy <- out %>% as.data.frame() %>% 
    gather(type, concentration, -time) %>%
    mutate(time_min = time / 60) 
    
  
  uncleaved_plot <- out_tidy %>% 
    filter(type != "enzyme") %>%
    group_by(time_min) %>%
    summarise(all_uncleaved = sum(concentration)) %>%
    (function(data) { 
      ggplot(data,aes(x = time_min, y = all_uncleaved)) + geom_line() +
        ggtitle(paste0(title," uncleaved RNAs"))  +
        ylim(0, max(data$all_uncleaved)) 
    })

  print(uncleaved_plot)
  
  auxiliary_plot <- 
    ggplot(out_tidy, aes(x = time_min, y = concentration, color = type, linetype = type)) + geom_line() +
    ggtitle(paste0(title," all reactants") ) + 
    ylim(0, max(out_tidy$concentration))


  print(auxiliary_plot)
}

for(prop_AGO_available_siRNA in c(1,0.5,0.1)) {



  params_siRNA <- c(k_cat = k_cat_siRNA, k_on = k_on_siRNA, k_off = k_off_siRNA)
  
  state <- c(target = siRNA_target_somatic / somatic_volume, enzyme = prop_AGO_available_siRNA * AGO_somatic / somatic_volume, complex = 0)
  
  out_siRNA <- ode(y = state, times = times, func = one_step_degradation, parms = params_siRNA)
  
  
  
  plot_ode_result(out_siRNA,paste0("Somatic, prop AGO = ", prop_AGO_available_siRNA))
  
  
  
  state <- c(target = siRNA_target_oocyte / oocyte_volume, enzyme = prop_AGO_available_siRNA * AGO_oocyte / oocyte_volume, complex = 0)
  
  out_siRNA_oo <- ode(y = state, times = times, func = one_step_degradation, parms = params_siRNA)
  
  plot_ode_result(out_siRNA_oo,paste0("Oocyte, prop AGO = ", prop_AGO_available_siRNA))
}
```

Modulating just k_cat for miRNA is not enough - even though not everything is cleaved in somatic (even ignoring mRNA synthesis), I get noticeable cleavage in oocyte.

```{r}
prop_AGO_available_miRNA = 0.1


k_cat_miRNA_one_step <- 0.2 * k_cat_siRNA
params_miRNA_one_step <- c(k_cat = k_cat_miRNA_one_step, k_on = k_on_miRNA, k_off = k_off_miRNA)

state <- c(target = miRNA_target_somatic / somatic_volume, enzyme = prop_AGO_available_miRNA * AGO_somatic / somatic_volume, complex = 0)

out_miRNA_one_step_somatic <- ode(y = state, times = times, func = one_step_degradation, parms = params_miRNA_one_step)

plot_ode_result(out_miRNA_one_step_somatic, "miRNA - somatic - one step deg.")


state <- c(target = miRNA_target_oocyte / oocyte_volume, enzyme = prop_AGO_available_miRNA * AGO_oocyte / oocyte_volume, complex = 0)

out_miRNA_one_step_oo <- ode(y = state, times = times, func = one_step_degradation, parms = params_miRNA_one_step)

plot_ode_result(out_miRNA_one_step_oo, "miRNA - Oocyte - one step deg.")

```

Adding one step to degradation is enough

```{r}
k_cat_miRNA <- 0.2 * k_cat_siRNA
k_intermediate_miRNA <- 1 * k_cat_siRNA

times <- seq(0,6*60*60, length.out = 100) #Skip first few seconds as the system stabilizes


two_step_degradation <- function(t, state, parameters) {
  with(as.list(c(state, parameters)), {
    d_target <- -k_on * enzyme * target + k_off * complex 
    d_enzyme <- -k_on * enzyme * target + k_off * complex + k_cat * intermediate
    d_complex <- k_on * enzyme * target - k_off * complex - k_intermediate * complex
    d_intermediate <- k_intermediate * complex - k_cat * intermediate
    list(c(d_target, d_enzyme, d_complex, d_intermediate))
  })
}

params_miRNA <- c(k_on = k_on_miRNA, k_off = k_off_miRNA, k_cat = k_cat_miRNA, k_intermediate = k_intermediate_miRNA)

state_somatic <- c(target = miRNA_target_somatic / somatic_volume, enzyme = (prop_AGO_available_miRNA * AGO_somatic) / somatic_volume, complex = 0, intermediate = 0)

out_miRNA <- ode(y = state_somatic, times = times, func = two_step_degradation, parms = params_miRNA)



plot_ode_result(out_miRNA, "Somatic")

state_oo <- c(target = miRNA_target_oocyte / oocyte_volume, enzyme = (prop_AGO_available_miRNA * AGO_oocyte) / oocyte_volume, complex = 0, intermediate = 0)

out_miRNA_oo <- ode(y = state_oo, times = times, func = two_step_degradation, parms = params_miRNA)

plot_ode_result(out_miRNA_oo, "Oocyte")


```

